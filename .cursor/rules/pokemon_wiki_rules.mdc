---
alwaysApply: true
description: Comprehensive rules and guidelines for the Pokemon Wiki Android project, including architecture, coding standards, and best practices.
---

# Pokemon Wiki Android 项目开发规则

## 项目基本信息
- **项目名称**: Pokemon Wiki
- **包名**: `com.healthybear.pokemon.wiki`
- **最低SDK**: API 24 (Android 7.0)
- **目标SDK**: API 36 (Android 14)
- **编译SDK**: API 36
- **Java版本**: 11
- **Kotlin版本**: 2.0.21
- **AGP版本**: 8.11.1

## 技术架构规范

### UI框架
- **主要UI框架**: Jetpack Compose
- **主题**: Material3
- **支持特性**: 
  - Data Binding
  - View Binding
  - Edge-to-Edge支持

### 网络层架构
- **HTTP客户端**: Retrofit 3.0.0 + OkHttp 5.0.0
- **数据序列化**: Moshi (JSON)
- **网络拦截器**: OkHttp Logging Interceptor
- **错误处理**: 自定义异常处理机制

### 数据存储
- **键值存储**: MMKV (腾讯开源)
- **会话管理**: 自定义SessionStorage

### 图片加载
- **主要**: Coil 2.7.0
- **支持格式**: GIF, SVG, Video
- **备选**: Glide 4.16.0

## 代码规范

### 包结构
```
com.healthybear.pokemon.wiki/
├── App.kt                    # 应用程序入口
├── MainActivity.kt           # 主活动
├── mmkv/                     # 数据存储
├── network/                  # 网络层
│   ├── constant/            # 网络常量
│   ├── error/               # 错误处理
│   ├── manager/             # 网络管理
│   ├── repository/          # 数据仓库
│   └── response/            # 响应模型
└── ui/                      # 用户界面
    └── theme/               # 主题相关
```

### 命名规范
- **类名**: PascalCase (如: `MainActivity`, `SessionStorage`)
- **函数名**: camelCase (如: `onCreate`, `enableEdgeToEdge`)
- **常量**: UPPER_SNAKE_CASE (如: `INTERNET`, `ACCESS_NETWORK_STATE`)
- **包名**: 全小写，点分隔 (如: `com.healthybear.pokemon.wiki`)

### 权限管理
- **网络权限**: `INTERNET`, `ACCESS_NETWORK_STATE`, `ACCESS_WIFI_STATE`
- **权限申请**: 在AndroidManifest.xml中声明

## 依赖管理规范

### 版本管理
- 使用`gradle/libs.versions.toml`统一管理版本
- 版本号格式: `major.minor.patch`
- 关键依赖版本锁定

### 核心依赖
```kotlin
// 基础框架
implementation(libs.androidx.core.ktx)
implementation(libs.androidx.lifecycle.runtime.ktx)

// Compose相关
implementation(libs.androidx.activity.compose)
implementation(platform(libs.androidx.compose.bom))

// 网络相关
implementation(libs.retrofit)
implementation(libs.okhttp)
implementation(libs.moshi)

// 工具库
implementation(libs.utilcodex)
implementation(libs.mmkv)
```

## 开发流程规范

### 代码提交
- 使用Git进行版本控制
- 提交信息格式: `type: description`
- 类型包括: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`

### 测试规范
- 单元测试: JUnit 4
- 集成测试: AndroidX Test
- UI测试: Espresso + Compose Testing

### 构建配置
- 发布版本: 启用代码混淆
- 调试版本: 保留调试信息
- 使用ProGuard规则优化

## 性能优化规范

### 内存管理
- 使用MMKV进行高效数据存储
- 图片加载使用Coil，支持内存缓存
- 及时释放不需要的资源

### 网络优化
- 使用Retrofit进行网络请求
- 实现请求拦截器和响应缓存
- 错误重试机制

### UI性能
- 使用Compose进行声明式UI开发
- 避免过度绘制
- 使用LazyColumn等懒加载组件

## 安全规范

### 数据安全
- 敏感数据使用MMKV加密存储
- 网络请求使用HTTPS
- 避免在代码中硬编码敏感信息

### 权限安全
- 最小权限原则
- 运行时权限检查
- 用户隐私保护

## 错误处理规范

### 异常处理
- 网络异常: 自定义ApiException
- 业务异常: 自定义CusError
- 全局异常: ExceptionHandler统一处理

### 日志记录
- 使用Logging Interceptor记录网络请求
- 关键操作记录日志
- 生产环境关闭调试日志

## 文档规范

### 代码注释
- 公共API必须添加文档注释
- 复杂逻辑添加行内注释
- 使用KDoc格式

### 架构文档
- 网络层架构图
- 数据流图
- API接口文档

## Cursor AI 助手使用规则

### 代码生成
- 优先使用Kotlin语言
- 遵循Jetpack Compose最佳实践
- 使用项目现有的架构模式

### 代码审查
- 检查是否符合项目命名规范
- 验证依赖使用是否正确
- 确保错误处理机制完善

### 重构建议
- 保持代码结构清晰
- 遵循SOLID原则
- 提高代码可测试性

### Context7 MCP服务使用规则
- **优先使用Context7**: 当需要查询库文档、API参考或技术信息时，优先使用Context7 MCP服务
- **库文档查询**: 使用Context7获取最新的库文档，确保代码使用正确的API和最佳实践
- **版本兼容性**: 通过Context7查询库的版本兼容性信息，确保与项目依赖版本匹配
- **API参考**: 使用Context7获取详细的API文档，包括参数说明、返回值、使用示例等
- **最佳实践**: 通过Context7查询库的官方推荐用法和最佳实践指南
- **错误解决**: 使用Context7查询常见问题和解决方案，快速解决开发中遇到的问题

### 口袋妖怪主题配色方案使用规则
- **主题色彩系统**: 使用项目自定义的口袋妖怪主题色彩系统，包括核心色彩、类型色彩和状态色彩
- **色彩文件位置**: 所有主题相关色彩定义在 `app/src/main/java/com/healthybear/pokemon/wiki/ui/theme/Color.kt` 中
- **主题配置**: 主题配置和状态管理在 `app/src/main/java/com/healthybear/pokemon/wiki/ui/theme/Theme.kt` 中
- **主题切换组件**: 使用 `app/src/main/java/com/healthybear/pokemon/wiki/ui/theme/ThemeSwitcher.kt` 中的主题切换UI组件
- **主题数据结构**: 主题相关数据结构定义在 `app/src/main/java/com/healthybear/pokemon/wiki/ui/theme/ThemeData.kt` 中
- **色彩使用原则**:
  - 主要UI元素使用 `PokemonPrimary` (皮卡丘金)
  - 次要UI元素使用 `PokemonSecondary` (妙蛙绿)
  - 强调色使用 `PokemonAccent` (小火龙橙)
  - 宝可梦类型相关UI使用对应的类型色彩
  - 状态指示使用 `PokemonSuccess`、`PokemonWarning`、`PokemonError` 等状态色彩
- **主题模式支持**: 支持 LIGHT、DARK、SYSTEM、AUTO 四种主题模式
- **动态色彩**: 在Android 12+设备上支持动态色彩，同时保持口袋妖怪主题特色
- **无障碍设计**: 确保所有色彩组合满足无障碍对比度要求

### 宝可梦动态配色系统使用规则
- **动态配色生成器**: 使用 `PokemonDynamicColorGenerator` 对象根据宝可梦类型自动生成配色方案
- **配色优先级**: 宝可梦动态配色 > 系统动态配色 > 静态配色回退
- **宝可梦类型选择**: 使用 `PokemonTypeSelector` 组件让用户选择宝可梦类型
- **动态配色控制**: 使用 `PokemonDynamicColorSwitch` 组件控制是否启用动态配色
- **主题状态管理**: 通过 `PokemonThemeState` 对象管理当前主题、选择的宝可梦类型和动态配色开关状态
- **HSL色彩科学**: 系统使用HSL色彩空间进行智能色彩搭配和互补色计算
- **色彩混合算法**: 使用 `Color.blendWith()` 扩展函数进行色彩混合，生成背景和表面色彩
- **主题预览**: 使用 `PokemonEnhancedThemePreviewCard` 组件预览不同主题和宝可梦类型的配色效果
- **综合控制面板**: 使用 `PokemonThemeControlPanel` 组件提供完整的主题控制功能
- **宝可梦类型支持**: 支持18种宝可梦类型，包括火、水、草、电、冰、格斗、毒、地面、飞行、超能、虫、岩石、幽灵、龙、恶、钢、妖精、一般
- **色彩生成算法**: 
  - 主色调基于选择的宝可梦类型
  - 次要色调为主色调的变体（透明度调节）
  - 第三色调为主色调的互补色（HSL色相旋转180度）
  - 背景色为主色调与黑白的基础色混合
- **性能优化**: 使用 `mutableStateOf` 确保响应式更新，避免不必要的色彩重新计算

### 项目文档管理规则
- **根目录README.md**: 项目根目录的 `README.md` 是整个工程的文档入口，必须保持最新和完整
- **文档更新同步**: 当生成、删除或更新其他markdown文件时，必须同步更新根目录的 `README.md`
- **文档结构**: 根目录 `README.md` 应包含项目概述、技术架构、快速开始、开发指南、文档导航等核心信息
- **文档维护**: 所有新增的文档功能、组件或模块都应在根目录 `README.md` 中有所体现

## 项目特定规则

### Pokemon Wiki 功能
- 实现宝可梦图鉴功能
- 支持网络数据获取
- 本地数据缓存
- 响应式UI设计

### 技术栈要求
- 必须使用Jetpack Compose
- 网络层使用Retrofit + Moshi
- 数据存储使用MMKV
- 图片加载使用Coil

### 代码质量
- 代码覆盖率 > 80%
- 无内存泄漏
- 网络请求有重试机制
- 错误处理完善